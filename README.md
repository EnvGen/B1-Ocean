# B1 Ocean project

*NBIS project id #6005*

## Log

- 2022-01-21

Workflow will be restarted on Rackham using the `config/myconfig_R-samples.yaml`
configfile. However, the time limit should be updated on the `pfam_scan` rule as
it seems to be taking longer than expected for a few assemblies.

The `config/cluster.yaml` file should be updated to contain:

```yaml
pfam_scan:
  time: 14400
```

The work directory should probably be unlocked as well. Then the workflow can be
restarted with (remember to remove the `-n` flag):

```bash
snakemake --profile slurm --use-conda --configfile config/myconfig_R-samples.yaml -j 100 -rpk -n annotate
```

- November - December 2021

Project was set up on Rackham under `/crex/proj/snic2020-6-126/nobackup/nbis-meta-2.3.2`. 

The `nbis-meta` workflow (v. 2.3.2) was downloaded from GitHub. The conda environment
was installed under `/crex/proj/snic2020-6-126/nobackup/envs/nbis-meta` using 
command:

```bash
mkdir envs
conda env create -f environment.yml -p envs/nbis-meta
```

Config and sample files were set up as `config/myconfig.yaml` and `sample_list_user-ids.tsv`,
respectively. 

**Preprocessing**

Preprocessing was run with `cutadapt` as:

```bash
snakemake --profile slurm --use-conda --configfile config/myconfig.yaml -j 100 -rpk -n qc
```

**Assembly**

Assembly was run with `megahit` as:

```bash
snakemake --profile slurm --use-conda --configfile config/myconfig.yaml -j 100 -rpk -n assemble
```

**Annotation**

After this, an attempt at annotating the 'R' samples was made using a configfile
`config/myconfig_R-samples.yaml`:

```bash
snakemake --profile slurm --use-conda --configfile config/myconfig_R-samples.yaml -j 100 -rpk -n annotate
```

However, the `*.bam` files generated by the workflow used up ~7TB of disk space
causing the project to hit the uquota limit around Dec 28, 2021. This also caused
the workflow to fail as files could no longer be moved from local node storage 
to the project directory.